/**
 * skylark-panolens - A version of panolens that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-panolens/
 * @license MIT
 */
define(["skylark-threejs","../DataImage","../Constants","../loaders/TextureLoader","skylark-tweenjs"],function(t,e,i,n,s){"use strict";function l(l=300,o,a){o=o||e.Info,t.Sprite.call(this),this.type="infospot",this.animated=void 0===a||a,this.isHovering=!1,this.frustumCulled=!1,this.element=null,this.toPanorama=null,this.cursorStyle=null,this.mode=i.MODES.NORMAL,this.scale.set(l,l,1),this.rotation.y=Math.PI,this.container=null,this.originalRaycast=this.raycast,this.HANDLER_FOCUS=null,this.material.side=t.DoubleSide,this.material.depthTest=!1,this.material.transparent=!0,this.material.opacity=0,this.scaleUpAnimation=new s.Tween,this.scaleDownAnimation=new s.Tween;const h=function(e){if(!this.material)return;const i=e.image.width/e.image.height,n=new t.Vector3;e.image.width=e.image.naturalWidth||64,e.image.height=e.image.naturalHeight||64,this.scale.set(i*l,l,1),n.copy(this.scale),this.scaleUpAnimation=new s.Tween(this.scale).to({x:1.3*n.x,y:1.3*n.y},500).easing(s.Easing.Elastic.Out),this.scaleDownAnimation=new s.Tween(this.scale).to({x:n.x,y:n.y},500).easing(s.Easing.Elastic.Out),this.material.map=e,this.material.needsUpdate=!0}.bind(this);this.showAnimation=new s.Tween(this.material).to({opacity:1},500).onStart(this.enableRaycast.bind(this,!0)).easing(s.Easing.Quartic.Out),this.hideAnimation=new s.Tween(this.material).to({opacity:0},500).onStart(this.enableRaycast.bind(this,!1)).easing(s.Easing.Quartic.Out),this.addEventListener("click",this.onClick),this.addEventListener("hover",this.onHover),this.addEventListener("hoverenter",this.onHoverStart),this.addEventListener("hoverleave",this.onHoverEnd),this.addEventListener("panolens-dual-eye-effect",this.onDualEyeEffect),this.addEventListener("panolens-container",this.setContainer.bind(this)),this.addEventListener("dismiss",this.onDismiss),this.addEventListener("panolens-infospot-focus",this.setFocusMethod),n.load(o,h)}return l.prototype=Object.assign(Object.create(t.Sprite.prototype),{constructor:l,setContainer:function(t){let e;t instanceof HTMLElement?e=t:t&&t.container&&(e=t.container),e&&this.element&&e.appendChild(this.element),this.container=e},getContainer:function(){return this.container},onClick:function(t){this.element&&this.getContainer()&&(this.onHoverStart(t),this.lockHoverElement())},onDismiss:function(){this.element&&(this.unlockHoverElement(),this.onHoverEnd())},onHover:function(){},onHoverStart:function(t){if(!this.getContainer())return;const e=this.cursorStyle||(this.mode===i.MODES.NORMAL?"pointer":"default"),{scaleDownAnimation:n,scaleUpAnimation:s,element:l}=this;if(this.isHovering=!0,this.container.style.cursor=e,this.animated&&(n.stop(),s.start()),l&&t.mouseEvent.clientX>=0&&t.mouseEvent.clientY>=0){const{left:t,right:e,style:n}=l;this.mode===i.MODES.CARDBOARD||this.mode===i.MODES.STEREO?(n.display="none",t.style.display="block",e.style.display="block",l._width=t.clientWidth,l._height=t.clientHeight):(n.display="block",t&&(t.style.display="none"),e&&(e.style.display="none"),l._width=l.clientWidth,l._height=l.clientHeight)}},onHoverEnd:function(){if(!this.getContainer())return;const{scaleDownAnimation:t,scaleUpAnimation:e,element:i}=this;if(this.isHovering=!1,this.container.style.cursor="default",this.animated&&(e.stop(),t.start()),i&&!this.element.locked){const{left:t,right:e,style:n}=i;n.display="none",t&&(t.style.display="none"),e&&(e.style.display="none"),this.unlockHoverElement()}},onDualEyeEffect:function(t){if(!this.getContainer())return;let e,n,s;this.mode=t.mode,e=this.element,n=this.container.clientWidth/2,s=this.container.clientHeight/2,e&&(e.left||e.right||(e.left=e.cloneNode(!0),e.right=e.cloneNode(!0)),this.mode===i.MODES.CARDBOARD||this.mode===i.MODES.STEREO?(e.left.style.display=e.style.display,e.right.style.display=e.style.display,e.style.display="none"):(e.style.display=e.left.style.display,e.left.style.display="none",e.right.style.display="none"),this.translateElement(n,s),this.container.appendChild(e.left),this.container.appendChild(e.right))},translateElement:function(t,e){if(!this.element._width||!this.element._height||!this.getContainer())return;let n,s,l,o,a,h,r;r=this.container,n=t-(o=(l=this.element)._width/2),s=e-(a=l._height/2)-(h=void 0!==l.verticalDelta?l.verticalDelta:40),this.mode!==i.MODES.CARDBOARD&&this.mode!==i.MODES.STEREO||!l.left||!l.right||t===r.clientWidth/2&&e===r.clientHeight/2?this.setElementStyle("transform",l,"translate("+n+"px, "+s+"px)"):(n=r.clientWidth/4-o+(t-r.clientWidth/2),s=r.clientHeight/2-a-h+(e-r.clientHeight/2),this.setElementStyle("transform",l.left,"translate("+n+"px, "+s+"px)"),n+=r.clientWidth/2,this.setElementStyle("transform",l.right,"translate("+n+"px, "+s+"px)"))},setElementStyle:function(t,e,i){const n=e.style;"transform"===t&&(n.webkitTransform=n.msTransform=n.transform=i)},setText:function(t){this.element&&(this.element.textContent=t)},setCursorHoverStyle:function(t){this.cursorStyle=t},addHoverText:function(t,e=40){this.element||(this.element=document.createElement("div"),this.element.style.display="none",this.element.style.color="#fff",this.element.style.top=0,this.element.style.maxWidth="50%",this.element.style.maxHeight="50%",this.element.style.textShadow="0 0 3px #000000",this.element.style.fontFamily='"Trebuchet MS", Helvetica, sans-serif',this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=e),this.setText(t)},addHoverElement:function(t,e=40){this.element||(this.element=t.cloneNode(!0),this.element.style.display="none",this.element.style.top=0,this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=e)},removeHoverElement:function(){this.element&&(this.element.left&&(this.container.removeChild(this.element.left),this.element.left=null),this.element.right&&(this.container.removeChild(this.element.right),this.element.right=null),this.container.removeChild(this.element),this.element=null)},lockHoverElement:function(){this.element&&(this.element.locked=!0)},unlockHoverElement:function(){this.element&&(this.element.locked=!1)},enableRaycast:function(t=!0){this.raycast=t?this.originalRaycast:()=>{}},show:function(t=0){const{animated:e,hideAnimation:i,showAnimation:n,material:s}=this;e?(i.stop(),n.delay(t).start()):(this.enableRaycast(!0),s.opacity=1)},hide:function(t=0){const{animated:e,hideAnimation:i,showAnimation:n,material:s}=this;e?(n.stop(),i.delay(t).start()):(this.enableRaycast(!1),s.opacity=0)},setFocusMethod:function(t){t&&(this.HANDLER_FOCUS=t.method)},focus:function(t,e){this.HANDLER_FOCUS&&(this.HANDLER_FOCUS(this.position,t,e),this.onDismiss())},dispose:function(){const{geometry:t,material:e}=this,{map:i}=e;this.removeHoverElement(),this.parent&&this.parent.remove(this),i&&(i.dispose(),e.map=null),t&&(t.dispose(),this.geometry=null),e&&(e.dispose(),this.material=null)}}),l});
//# sourceMappingURL=../sourcemaps/infospot/Infospot.js.map
