/**
 * skylark-panolens - A version of panolens that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-panolens/
 * @license MIT
 */
define(["../Constants","../DataImage","skylark-threejs"],function(e,t,n){"use strict";function i(e){e||console.warn("PANOLENS.Widget: No container specified"),n.EventDispatcher.call(this),this.DEFAULT_TRANSITION="all 0.27s ease",this.TOUCH_ENABLED=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch),this.PREVENT_EVENT_HANDLER=function(e){e.preventDefault(),e.stopPropagation()},this.container=e,this.barElement=null,this.fullscreenElement=null,this.videoElement=null,this.settingElement=null,this.mainMenu=null,this.activeMainItem=null,this.activeSubMenu=null,this.mask=null}return i.prototype=Object.assign(Object.create(n.EventDispatcher.prototype),{constructor:i,addControlBar:function(){if(this.container){var e,t,n,i,s=this;i="linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))",(e=document.createElement("div")).style.width="100%",e.style.height="44px",e.style.float="left",e.style.transform=e.style.webkitTransform=e.style.msTransform="translateY(-100%)",e.style.background="-webkit-"+i,e.style.background="-moz-"+i,e.style.background="-o-"+i,e.style.background="-ms-"+i,e.style.background=i,e.style.transition=this.DEFAULT_TRANSITION,e.style.pointerEvents="none",e.isHidden=!1,e.toggle=function(){e.isHidden=!e.isHidden,t=e.isHidden?"translateY(0)":"translateY(-100%)",n=e.isHidden?0:1,e.style.transform=e.style.webkitTransform=e.style.msTransform=t,e.style.opacity=n};var o=this.createDefaultMenu();this.mainMenu=this.createMainMenu(o),e.appendChild(this.mainMenu);var l=this.createMask();this.mask=l,this.container.appendChild(l),e.dispose=function(){s.fullscreenElement&&(e.removeChild(s.fullscreenElement),s.fullscreenElement.dispose(),s.fullscreenElement=null),s.settingElement&&(e.removeChild(s.settingElement),s.settingElement.dispose(),s.settingElement=null),s.videoElement&&(e.removeChild(s.videoElement),s.videoElement.dispose(),s.videoElement=null)},this.container.appendChild(e),this.mask.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener("mouseup",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener(s.TOUCH_ENABLED?"touchend":"click",function(e){e.preventDefault(),e.stopPropagation(),s.mask.hide(),s.settingElement.deactivate()},!1),this.addEventListener("control-bar-toggle",e.toggle),this.barElement=e}else console.warn("Widget container not set")},createDefaultMenu:function(){var t,n=this;return t=function(e,t){return function(){n.dispatchEvent({type:"panolens-viewer-handler",method:e,data:t})}},[{title:"Control",subMenu:[{title:this.TOUCH_ENABLED?"Touch":"Mouse",handler:t("enableControl",e.CONTROLS.ORBIT)},{title:"Sensor",handler:t("enableControl",e.CONTROLS.DEVICEORIENTATION)}]},{title:"Mode",subMenu:[{title:"Normal",handler:t("disableEffect")},{title:"Cardboard",handler:t("enableEffect",e.MODES.CARDBOARD)},{title:"Stereoscopic",handler:t("enableEffect",e.MODES.STEREO)}]}]},addControlButton:function(e){let t;switch(e){case"fullscreen":t=this.createFullscreenButton(),this.fullscreenElement=t;break;case"setting":t=this.createSettingButton(),this.settingElement=t;break;case"video":t=this.createVideoControl(),this.videoElement=t;break;default:return}t&&this.barElement.appendChild(t)},createMask:function(){const e=document.createElement("div");return e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.width="100%",e.style.height="100%",e.style.background="transparent",e.style.display="none",e.show=function(){this.style.display="block"},e.hide=function(){this.style.display="none"},e},createSettingButton:function(){let e,n=this;return(e=this.createCustomItem({style:{backgroundImage:'url("'+t.Setting+'")',webkitTransition:this.DEFAULT_TRANSITION,transition:this.DEFAULT_TRANSITION},onTap:function(e){e.preventDefault(),e.stopPropagation(),n.mainMenu.toggle(),this.activated?this.deactivate():this.activate()}})).activate=function(){this.style.transform="rotate3d(0,0,1,90deg)",this.activated=!0,n.mask.show()},e.deactivate=function(){this.style.transform="rotate3d(0,0,0,0)",this.activated=!1,n.mask.hide(),n.mainMenu&&n.mainMenu.visible&&n.mainMenu.hide(),n.activeSubMenu&&n.activeSubMenu.visible&&n.activeSubMenu.hide(),n.mainMenu&&n.mainMenu._width&&(n.mainMenu.changeSize(n.mainMenu._width),n.mainMenu.unslideAll())},e.activated=!1,e},createFullscreenButton:function(){let e,n,i=this,s=!1,o=!0;const{container:l}=this;if(n="panolens-style-addon",document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled){if(document.addEventListener("fullscreenchange",a,!1),document.addEventListener("webkitfullscreenchange",a,!1),document.addEventListener("mozfullscreenchange",a,!1),document.addEventListener("MSFullscreenChange",a,!1),e=this.createCustomItem({style:{backgroundImage:'url("'+t.FullscreenEnter+'")'},onTap:function(e){e.preventDefault(),e.stopPropagation(),o=!1,s?(document.exitFullscreen&&document.exitFullscreen(),document.msExitFullscreen&&document.msExitFullscreen(),document.mozCancelFullScreen&&document.mozCancelFullScreen(),document.webkitExitFullscreen&&document.webkitExitFullscreen(),s=!1):(l.requestFullscreen&&l.requestFullscreen(),l.msRequestFullscreen&&l.msRequestFullscreen(),l.mozRequestFullScreen&&l.mozRequestFullScreen(),l.webkitRequestFullscreen&&l.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),s=!0),this.style.backgroundImage=s?'url("'+t.FullscreenLeave+'")':'url("'+t.FullscreenEnter+'")'}}),!document.querySelector("panolens-style-addon")){const e=document.createElement("style");e.id="panolens-style-addon",e.innerHTML=":-webkit-full-screen { width: 100% !important; height: 100% !important }",document.body.appendChild(e)}return e}function a(){o&&(s=!s,e.style.backgroundImage=s?'url("'+t.FullscreenLeave+'")':'url("'+t.FullscreenEnter+'")'),i.dispatchEvent({type:"panolens-viewer-handler",method:"onWindowResize"}),o=!0}},createVideoControl:function(){const e=document.createElement("span");return e.style.display="none",e.show=function(){e.style.display=""},e.hide=function(){e.style.display="none",e.controlButton.paused=!0,e.controlButton.update()},e.controlButton=this.createVideoControlButton(),e.seekBar=this.createVideoControlSeekbar(),e.appendChild(e.controlButton),e.appendChild(e.seekBar),e.dispose=function(){e.removeChild(e.controlButton),e.removeChild(e.seekBar),e.controlButton.dispose(),e.controlButton=null,e.seekBar.dispose(),e.seekBar=null},this.addEventListener("video-control-show",e.show),this.addEventListener("video-control-hide",e.hide),e},createVideoControlButton:function(){const e=this;const n=this.createCustomItem({style:{float:"left",backgroundImage:'url("'+t.VideoPlay+'")'},onTap:function(t){t.preventDefault(),t.stopPropagation(),e.dispatchEvent({type:"panolens-viewer-handler",method:"toggleVideoPlay",data:!this.paused}),this.paused=!this.paused,n.update()}});return n.paused=!0,n.update=function(e){this.paused=void 0!==e?e:this.paused,this.style.backgroundImage='url("'+(this.paused?t.VideoPlay:t.VideoPause)+'")'},n},createVideoControlSeekbar:function(){let e,t,n,i,s,o,l=this,a=!1;function r(e){e.stopPropagation(),a=!0,i=e.clientX||e.changedTouches&&e.changedTouches[0].clientX,s=parseInt(t.style.width)/100,l.container.addEventListener("mousemove",d,{passive:!0}),l.container.addEventListener("mouseup",c,{passive:!0}),l.container.addEventListener("touchmove",d,{passive:!0}),l.container.addEventListener("touchend",c,{passive:!0})}function d(t){if(a){const n=t.clientX||t.changedTouches&&t.changedTouches[0].clientX;o=(n-i)/e.clientWidth,o=(o=s+o)>1?1:o<0?0:o,e.setProgress(o),l.dispatchEvent({type:"panolens-viewer-handler",method:"setVideoCurrentTime",data:o})}}function c(e){e.stopPropagation(),a=!1,u()}function u(){l.container.removeEventListener("mousemove",d,!1),l.container.removeEventListener("mouseup",c,!1),l.container.removeEventListener("touchmove",d,!1),l.container.removeEventListener("touchend",c,!1)}return(t=document.createElement("div")).style.width="0%",t.style.height="100%",t.style.backgroundColor="#fff",(n=document.createElement("div")).style.float="right",n.style.width="14px",n.style.height="14px",n.style.transform="translate(7px, -5px)",n.style.borderRadius="50%",n.style.backgroundColor="#ddd",n.addEventListener("mousedown",r,{passive:!0}),n.addEventListener("touchstart",r,{passive:!0}),t.appendChild(n),(e=this.createCustomItem({style:{float:"left",width:"30%",height:"4px",marginTop:"20px",backgroundColor:"rgba(188,188,188,0.8)"},onTap:function(t){if(t.preventDefault(),t.stopPropagation(),t.target===n)return;const i=t.changedTouches&&t.changedTouches.length>0?(t.changedTouches[0].pageX-t.target.getBoundingClientRect().left)/this.clientWidth:t.offsetX/this.clientWidth;l.dispatchEvent({type:"panolens-viewer-handler",method:"setVideoCurrentTime",data:i}),e.setProgress(t.offsetX/this.clientWidth)},onDispose:function(){u(),t=null,n=null}})).appendChild(t),e.setProgress=function(e){t.style.width=100*e+"%"},this.addEventListener("video-update",function(t){e.setProgress(t.percentage)}),e.progressElement=t,e.progressElementControl=n,e},createMenuItem:function(e){const n=this,i=document.createElement("a");return i.textContent=e,i.style.display="block",i.style.padding="10px",i.style.textDecoration="none",i.style.cursor="pointer",i.style.pointerEvents="auto",i.style.transition=this.DEFAULT_TRANSITION,i.slide=function(e){this.style.transform="translateX("+(e?"":"-")+"100%)"},i.unslide=function(){this.style.transform="translateX(0)"},i.setIcon=function(e){this.icon&&(this.icon.style.backgroundImage="url("+e+")")},i.setSelectionTitle=function(e){this.selection&&(this.selection.textContent=e)},i.addSelection=function(e){const t=document.createElement("span");return t.style.fontSize="13px",t.style.fontWeight="300",t.style.float="right",this.selection=t,this.setSelectionTitle(e),this.appendChild(t),this},i.addIcon=function(e=t.ChevronRight,n=!1,i=!1){const s=document.createElement("span");return s.style.float=n?"left":"right",s.style.width="17px",s.style.height="17px",s.style["margin"+(n?"Right":"Left")]="12px",s.style.backgroundSize="cover",i&&(s.style.transform="rotateZ(180deg)"),this.icon=s,this.setIcon(e),this.appendChild(s),this},i.addSubMenu=function(e,t){return this.subMenu=n.createSubMenu(e,t),this},i.addEventListener("mouseenter",function(){this.style.backgroundColor="#e0e0e0"},!1),i.addEventListener("mouseleave",function(){this.style.backgroundColor="#fafafa"},!1),i},createMenuItemHeader:function(e){const t=this.createMenuItem(e);return t.style.borderBottom="1px solid #333",t.style.paddingBottom="15px",t},createMainMenu:function(e){let t=this,n=this.createMenu();function i(e){e.preventDefault(),e.stopPropagation();let n=t.mainMenu,i=this.subMenu;n.hide(),n.slideAll(),n.parentElement.appendChild(i),t.activeMainItem=this,t.activeSubMenu=i,window.requestAnimationFrame(function(){n.changeSize(i.clientWidth),i.show(),i.unslideAll()})}n._width=200,n.changeSize(n._width);for(var s=0;s<e.length;s++){var o=n.addItem(e[s].title);if(o.style.paddingLeft="20px",o.addIcon().addEventListener(t.TOUCH_ENABLED?"touchend":"click",i,!1),e[s].subMenu&&e[s].subMenu.length>0){var l=e[s].subMenu[0].title;o.addSelection(l).addSubMenu(e[s].title,e[s].subMenu)}}return n},createSubMenu:function(e,t){let n,i=this,s=this.createMenu();function o(e){e.preventDefault(),e.stopPropagation(),(n=i.mainMenu).changeSize(n._width),n.unslideAll(),n.show(),s.slideAll(!0),s.hide(),"header"!==this.type&&(s.setActiveItem(this),i.activeMainItem.setSelectionTitle(this.textContent),this.handler&&this.handler())}s.items=t,s.activeItem=null,s.addHeader(e).addIcon(void 0,!0,!0).addEventListener(i.TOUCH_ENABLED?"touchend":"click",o,!1);for(let e=0;e<t.length;e++){const n=s.addItem(t[e].title);n.style.fontWeight=300,n.handler=t[e].handler,n.addIcon(" ",!0),n.addEventListener(i.TOUCH_ENABLED?"touchend":"click",o,!1),s.activeItem||s.setActiveItem(n)}return s.slideAll(!0),s},createMenu:function(){const e=this,n=document.createElement("span"),i=n.style;return i.padding="5px 0",i.position="fixed",i.bottom="100%",i.right="14px",i.backgroundColor="#fafafa",i.fontFamily="Helvetica Neue",i.fontSize="14px",i.visibility="hidden",i.opacity=0,i.boxShadow="0 0 12pt rgba(0,0,0,0.25)",i.borderRadius="2px",i.overflow="hidden",i.willChange="width, height, opacity",i.pointerEvents="auto",i.transition=this.DEFAULT_TRANSITION,n.visible=!1,n.changeSize=function(e,t){e&&(this.style.width=e+"px"),t&&(this.style.height=t+"px")},n.show=function(){this.style.opacity=1,this.style.visibility="visible",this.visible=!0},n.hide=function(){this.style.opacity=0,this.style.visibility="hidden",this.visible=!1},n.toggle=function(){this.visible?this.hide():this.show()},n.slideAll=function(e){for(let t=0;t<n.children.length;t++)n.children[t].slide&&n.children[t].slide(e)},n.unslideAll=function(){for(let e=0;e<n.children.length;e++)n.children[e].unslide&&n.children[e].unslide()},n.addHeader=function(t){const n=e.createMenuItemHeader(t);return n.type="header",this.appendChild(n),n},n.addItem=function(t){const n=e.createMenuItem(t);return n.type="item",this.appendChild(n),n},n.setActiveItem=function(e){this.activeItem&&this.activeItem.setIcon(" "),e.setIcon(t.Check),this.activeItem=e},n.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0),n.addEventListener("mouseup",this.PREVENT_EVENT_HANDLER,!0),n.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0),n},createCustomItem:function(e={}){const t=this,n=e.element||document.createElement("span"),{onDispose:i}=e;return n.style.cursor="pointer",n.style.float="right",n.style.width="44px",n.style.height="100%",n.style.backgroundSize="60%",n.style.backgroundRepeat="no-repeat",n.style.backgroundPosition="center",n.style.webkitUserSelect=n.style.MozUserSelect=n.style.userSelect="none",n.style.position="relative",n.style.pointerEvents="auto",n.addEventListener(t.TOUCH_ENABLED?"touchstart":"mouseenter",function(){n.style.filter=n.style.webkitFilter="drop-shadow(0 0 5px rgba(255,255,255,1))"},{passive:!0}),n.addEventListener(t.TOUCH_ENABLED?"touchend":"mouseleave",function(){n.style.filter=n.style.webkitFilter=""},{passive:!0}),this.mergeStyleOptions(n,e.style),e.onTap&&n.addEventListener(t.TOUCH_ENABLED?"touchend":"click",e.onTap,!1),n.dispose=function(){n.removeEventListener(t.TOUCH_ENABLED?"touchend":"click",e.onTap,!1),i&&e.onDispose()},n},mergeStyleOptions:function(e,t={}){for(let n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n]);return e},dispose:function(){this.barElement&&(this.container.removeChild(this.barElement),this.barElement.dispose(),this.barElement=null)}}),i});
//# sourceMappingURL=../sourcemaps/widget/Widget.js.map
